

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RandomAccess &mdash; HPCC FPGA Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=53b48696" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RandomAccess FPGA Benchmark Results" href="results/index.html" />
    <link rel="prev" title="STREAM FPGA Benchmark Results" href="../STREAM/results/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            HPCC FPGA Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Benchmark Descriptions:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../STREAM/index.html">STREAM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RandomAccess</a><ul>
<li class="toctree-l2"><a class="reference internal" href="results/index.html">RandomAccess FPGA Benchmark Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-parameters">Configuration Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detailed-description">Detailed Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-hints">Configuration Hints</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../FFT/index.html">FFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GEMM/index.html">GEMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PTRANS/index.html">PTRANS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LINPACK/index.html">LINPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../b_eff/index.html">b_eff</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Support:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/Basic%20Setup/index.html">Basic Build Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/Host%20Input%20Parameters/index.html">Execution of a Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/Project%20Structure/index.html">Structure of the Benchmark Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/json_output/index.html">JSON Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/multi_fpga/index.html">Multi-FPGA Benchmarking</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Benchmark Results:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FFT/results/index.html">FFT FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GEMM/results/index.html">GEMM FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="results/index.html">RandomAccess FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../STREAM/results/index.html">STREAM FPGA Benchmark Results</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HPCC FPGA Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">RandomAccess</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <section id="randomaccess">
<span id="id1"></span><h1>RandomAccess<a class="headerlink" href="#randomaccess" title="Link to this heading"></a></h1>
<p>This section contains all information related to the RandomAccess benchmark.</p>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="results/index.html">RandomAccess FPGA Benchmark Results</a></li>
</ul>
</div>
<section id="configuration-parameters">
<h2>Configuration Parameters<a class="headerlink" href="#configuration-parameters" title="Link to this heading"></a></h2>
<p>In <a class="reference internal" href="#ra-config"><span class="std std-numref">Table 5</span></a> the configuration parameters are shown that are used to modify the kernel.
All other parameters can also later be changed with the host code during runtime.</p>
<span id="ra-config"></span><table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 5 </span><span class="caption-text">Configuration parameters for the Kernel</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 37.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NUM_REPLICATIONS</span></code></p></td>
<td><p>Replicates all kernels the given number of times. This allows to simultaneously schedule multiple kernels with different input data. The data set might be split between the available kernels to speed up execution.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_DEVICE_BUFFER_SIZE</span></code></p></td>
<td><p>Size of the local memory buffer that stores intermediate values read from global memory. Used to reduce the impact of memory latency on the execution time.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_INTEL_USE_PRAGMA_IVDEP</span></code></p></td>
<td><p>Use the pragma <code class="docutils literal notranslate"><span class="pre">ivdep</span></code> on the outer loop of the kernel implementation. This will tell the compiler to ignore the dependencies between read and write to the global memory and allows the implementation in a single pipeline (use together with <code class="docutils literal notranslate"><span class="pre">DEVICE_BUFFER_SIZE=1</span></code>. NOTE: This might lead to a increased error above the allowed threshold!)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_RNG_COUNT_LOG</span></code></p></td>
<td><p>Log2 of the number of random number generators that will be generated per replication. This allows to achieve a better scaling behavior for large number of replications.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_RNG_DISTANCE</span></code></p></td>
<td><p>Distance between RNGs in shift register. Used to relax timing and increase clock frequency.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="detailed-description">
<h2>Detailed Description<a class="headerlink" href="#detailed-description" title="Link to this heading"></a></h2>
<p>The random access benchmark measures the performance for non-consecutive memory accesses expressed in the performance metric Mega Update Operations per Second (MUOPs).
It updates values in a data array <span class="math notranslate nohighlight">\(d \in \Bbb Z^n\)</span> such that <span class="math notranslate nohighlight">\(d_{i} = d_{i} \oplus a\)</span> where <span class="math notranslate nohighlight">\(a \in \Bbb Z\)</span> is a value from a pseudo random sequence.
n is defined to be a power of two.
As data type, 64 bit integers are used.
Since an exclusive or operation is used to update the values, applying the update again will lead to the initial value.
This is also used to verify the results on the host side.
The same updates are applied to the data array such that the data array should contain the initial values again, if all updates where successful.
The incorrect items are counted, and the error percentage is calculated with <span class="math notranslate nohighlight">\(\frac{error}{n} \cdot 100\)</span>.
An error of <span class="math notranslate nohighlight">\(&lt;1\%\)</span> has to be accomplished to pass the validation. Hence, update errors caused by concurrent data accesses are tolerated to some degree.
The performance of the implementation is mainly bound by the memory bandwidth and latency. So the kernel should be replicated to utilize all available memory banks.</p>
<p>The benchmark requires <span class="math notranslate nohighlight">\(4 \cdot n\)</span> updates on the array of length n.
Therefore, it uses a pseudo random sequence generator that is implemented in every kernel replication.
The index in the data array as well as the value of the update will be extracted from the random number.
For a more detailed description of the used pseudo random number scheme refer to the description on the <a class="reference external" href="https://icl.utk.edu/projectsfiles/hpcc/RandomAccess/">HPC Challenge website</a>.
Since every replication of the kernel is in charge of a distinct range of addresses that is placed in their memory bank, the kernel has to check if the calculated address is actually within its range.
Only then the value will be loaded from global memory and stored in a local memory buffer which size can be configured over the <code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_DEVICE_BUFFER_SIZE</span></code> parameter.
When the buffer is full, the benchmark will write back the updated values from the buffer to global memory.
With this approach, read after write dependencies will be relaxed which prevents pipeline stalls caused by pending load operations.
However, the buffer introduces update errors, if the same value is loaded multiple times since there are no additional checks implemented.
Since the benchmark allows a small amount of errors, changing the buffer size can be used as a trade-off between benchmark error and performance.
Also it has to be noted that the memory accesses are following a pseudo random order.
This means that the measured memory bandwidth will be considerably lower than for sequential memory accesses.
One cause are the missing memory bursts which usually increase the efficiency.
Moreover, the values are most likely located in different pages of the DDR memory which will introduce additional overheads.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_RNG_COUNT_LOG</span></code> allows to increase the amount of pseudo-random number generators per replications.
This increases the probability, that a valid index for every kernel replication will be generated in every clock cycle.
However, this also increases the logic usage and may lead to lower kernel frequencies.
On systems with many separate global memory banks like HBM boards or multi-FPGA setups where a lot of kernel replications are required, increasing the amount of RNGs
can increase the performance since the benchmark may get calculation bound by the RNGs otherwise.</p>
</section>
<section id="configuration-hints">
<h2>Configuration Hints<a class="headerlink" href="#configuration-hints" title="Link to this heading"></a></h2>
<p>The random access benchmark is not only limited by the random access global memory bandwidth but also by the calculation of the pseudo random number sequence.
Every kernel replication needs to calculate all random numbers in the sequence to check if they are in their range of responsibility.
For a high number of replications this will have a considerable impact in the measured performance because the number of updates per calculated random number will decrease.
Nevetheless, the number of replications should still be matched with the number of available memory banks to get the best performance.
<code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_DEVICE_BUFFER_SIZE</span></code> has to be picked as large as possible to reduce the impact of the memory latency.
It should not be too large to not exceed the allowed error of 1% or reduce the kernel frequency.
Additionally, the amount of pseudo-random number generators should be increased for high numbers of kernel replications while keeping an eye on the kernel frequency.
Choosing values for <code class="docutils literal notranslate"><span class="pre">HPCC_FPGA_RA_RNG_COUNT_LOG</span></code> which are higher than log2(<code class="docutils literal notranslate"><span class="pre">NUM_REPLICATIONS</span></code>) will not give much performance benefits, because a single kernel replication can
only process a single address per clock cycle.</p>
</section>
</section>


           </div>
          </div>
    <a href="https://github.com/pc2/hpcc_fpga">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../STREAM/results/index.html" class="btn btn-neutral float-left" title="STREAM FPGA Benchmark Results" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="results/index.html" class="btn btn-neutral float-right" title="RandomAccess FPGA Benchmark Results" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Marius Meyer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
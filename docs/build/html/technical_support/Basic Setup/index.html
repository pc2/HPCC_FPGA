

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basic Build Setup &mdash; HPCC FPGA Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=53b48696" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Execution of a Benchmark" href="../Host%20Input%20Parameters/index.html" />
    <link rel="prev" title="b_eff" href="../../b_eff/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            HPCC FPGA Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Benchmark Descriptions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../STREAM/index.html">STREAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RandomAccess/index.html">RandomAccess</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../FFT/index.html">FFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GEMM/index.html">GEMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PTRANS/index.html">PTRANS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LINPACK/index.html">LINPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../b_eff/index.html">b_eff</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Support:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic Build Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-benchmark-configuration">General Benchmark Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-build-targets">General Build Targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-and-build-stream-for-a-fictional-xilinx-fpga">Configure and Build STREAM for a fictional Xilinx FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-pre-defined-configurations">Using pre-defined Configurations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Host%20Input%20Parameters/index.html">Execution of a Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Project%20Structure/index.html">Structure of the Benchmark Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../json_output/index.html">JSON Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multi_fpga/index.html">Multi-FPGA Benchmarking</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Benchmark Results:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../FFT/results/index.html">FFT FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GEMM/results/index.html">GEMM FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RandomAccess/results/index.html">RandomAccess FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../STREAM/results/index.html">STREAM FPGA Benchmark Results</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HPCC FPGA Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Basic Build Setup</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <section id="basic-build-setup">
<h1>Basic Build Setup<a class="headerlink" href="#basic-build-setup" title="Link to this heading"></a></h1>
<p>The HPCChallenge Benchmark for FPGA is fully configurable over CMake when a new build directory is created.
Although it is possible, it is highly recommended to use a different directory for the build than the source directory.
In the following, we will configure the STREAM benchmark for the use with a fictional FPGA to show the basic configuration and build process.</p>
<section id="general-benchmark-configuration">
<h2>General Benchmark Configuration<a class="headerlink" href="#general-benchmark-configuration" title="Link to this heading"></a></h2>
<p>The <strong>configuration options</strong> are implemented as CMake build parameters and can be set when creating a new CMake build directory.
We recommend to create a new build directory for a benchmark in a folder <cite>build</cite> in the root directory of the project.
You may want to create a folder hierarchy in there e.g. to build the STREAM benchmark create a folder <cite>build/STREAM</cite> and change into that new folder.
Initialize a new CMake build directory by calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>PATH_TO_SOURCE_DIR
</pre></div>
</div>
<p>where <cite>PATH_TO_SOURCE_DIR</cite> would be <cite>../../STREAM</cite> in case of STREAM (the relative path to the source directory of the target benchmark).
Some of the configuration options are the same for each benchmark and are given in the Table below.
Especially the <code class="docutils literal notranslate"><span class="pre">FPGA_BOARD_NAME</span></code> is important to set, since it will specify the target board.
The <code class="docutils literal notranslate"><span class="pre">DEFAULT_*</span></code> options are used by the host code and can also be changed later at runtime.
The given default values will be set if no other values are given during configuration.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-number">Table 13 </span><span class="caption-text">General Configuration Options</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DEFAULT_DEVICE</span></code></p></td>
<td><p>-1</p></td>
<td><p>Index of the default device (-1 = ask)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DEFAULT_PLATFORM</span></code></p></td>
<td><p>-1</p></td>
<td><p>Index of the default platform (-1 = ask)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DEFAULT_REPETITIONS</span></code></p></td>
<td><p>10</p></td>
<td><p>Number of times the kernel will be executed</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">FPGA_BOARD_NAME</span></code></p></td>
<td><p>p520_hpc_sg280l</p></td>
<td><p>Name of the target board</p></td>
</tr>
</tbody>
</table>
<p>Additionally, the compile options for the Intel or Xilinx compiler have to be specified.
For the Intel compiler these are:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 14 </span><span class="caption-text">Intel Specific Configuration Options</span><a class="headerlink" href="#id2" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AOC_FLAGS</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-fpc</span> <span class="pre">-fp-relaxed</span> <span class="pre">-no-interleaving=default</span></code></p></td>
<td><p>Additional Intel AOC compiler flags that are used for kernel compilation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">INTEL_CODE_GENERATION_SETTINGS</span></code></p></td>
<td><p><cite>empty</cite></p></td>
<td><p>Path to the settings file that will be used as input for the code generator script. It may contain additional variables or functions.</p></td>
</tr>
</tbody>
</table>
<p>For the Xilinx compiler it is also necessary to set settings files for the compile and link step of the compiler.
The available options are given in the following table:</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 15 </span><span class="caption-text">Xilinx Vitis Specific Configuration Options</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">XILINX_COMPILE_FLAGS</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">40</span></code></p></td>
<td><p>Set special compiler flags like the number of used threads for compilation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">XILINX_COMPILE_SETTINGS_FILE</span></code></p></td>
<td><p>First <cite>settings.compile.xilinx.*.ini</cite> file found in the <cite>settings</cite> folder of the benchmark</p></td>
<td><p>Path to the file containing compile-time settings like the target clock frequency</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">XILINX_LINK_SETTINGS_FILE</span></code></p></td>
<td><p>First <cite>settings.link.xilinx.*.ini</cite> file found in the <cite>settings</cite> folder of the benchmark</p></td>
<td><p>Path to the file containing link settings like the mapping of the memory banks to the kernel parameters</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">XILINX_GENERATE_LINK_SETTINGS</span></code></p></td>
<td><p><cite>Yes</cite> if the link settings file ends on <cite>.generator.ini</cite> <cite>No</cite> otherwise</p></td>
<td><blockquote>
<div><p>Boolean flag indicating if the link settings file will be used as a source to generate a link settings file e.g. for a given number of kernel replications</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p>When building a benchmark for Xilinx FPGAs double-check the path to the settings files and if they match to the target board.
The settings files follow the name convention:</p>
<blockquote>
<div><p>settings.[compile|link].xilinx.KERNEL_NAME.[hbm|ddr](?.generator).ini</p>
</div></blockquote>
<p>where <cite>KERNEL_NAME</cite> is the name of the target OpenCL kernel file.
<cite>hbm</cite> or <cite>ddr</cite> is the type of used global memory.</p>
<p>All the given options can be given to CMake over the <cite>-D</cite> flag.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>../../RandomAccess<span class="w"> </span>-DFPGA_BOARD_NAME<span class="o">=</span>my_board<span class="w"> </span>-D...
</pre></div>
</div>
<p>or after configuration using the UI with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ccmake<span class="w"> </span>../../RandomAccess
</pre></div>
</div>
<p>After configuration, there are different build targets available to proceed with the build or development.
They are shortly explained in the following.</p>
</section>
<section id="general-build-targets">
<h2>General Build Targets<a class="headerlink" href="#general-build-targets" title="Link to this heading"></a></h2>
<p>In general, all benchmarks offer similar build targets.
In the following they are separated into targets for the host code and for the kernels.</p>
<p>The host code can be build with the targets described in the table below.
<cite>VENDOR</cite> is either <cite>intel</cite> or <cite>xilinx</cite> depending if the Intel SDK or Xilinx Vitis should be used.
<cite>BENCHMARK</cite> is the host code name that is specific to the used benchmark.
You can always get an overview of the available targets by executing the following command in the build directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="nb">help</span>
</pre></div>
</div>
<table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 16 </span><span class="caption-text">Host code build targets</span><a class="headerlink" href="#id4" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Target</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BENCHMARK_VENDOR</p></td>
<td><p>Builds the host application</p></td>
</tr>
<tr class="row-odd"><td><p>BENCHMARK_test_VENDOR</p></td>
<td><p>Compile the tests and its dependencies</p></td>
</tr>
</tbody>
</table>
<p>Moreover, there are additional targets to generate device reports and bitstreams.</p>
<p>The kernel targets are:</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-number">Table 17 </span><span class="caption-text">Device code build targets</span><a class="headerlink" href="#id5" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Target</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BASENAME_{<a href="#id6"><span class="problematic" id="id7">COMM_</span></a>}VENDOR</p></td>
<td><p>Synthesizes the device kernels (takes several hours!)</p></td>
</tr>
<tr class="row-odd"><td><p>BASENAME_{<a href="#id8"><span class="problematic" id="id9">COMM_</span></a>}report_VENDOR</p></td>
<td><p>Just compile the kernels and create logs and reports</p></td>
</tr>
<tr class="row-even"><td><p>BASENAME_{<a href="#id10"><span class="problematic" id="id11">COMM_</span></a>}emulate_VENDOR</p></td>
<td><p>Creates the emulation kernels</p></td>
</tr>
</tbody>
</table>
<p><cite>VENDOR</cite> is either <cite>intel</cite> or <cite>xilinx</cite> depending if the Intel SDK or Xilinx Vitis should be used.
<cite>BASENAME</cite> is the name of the file containing the device code.
A benchmark can provide multiple kernel implementations and thus, these targets will be generated for every file containing kernel code.
For all benchmarks using communication between FPGAs the different communcation types are encoded into the device code file name and therefore part of target name. These are b_eff, PTRANS and LINPACK.</p>
</section>
<section id="configure-and-build-stream-for-a-fictional-xilinx-fpga">
<h2>Configure and Build STREAM for a fictional Xilinx FPGA<a class="headerlink" href="#configure-and-build-stream-for-a-fictional-xilinx-fpga" title="Link to this heading"></a></h2>
<p>We assume the code base is already checked out and we have opened a terminal in the root directory of the project.
Also, all needed dependencies are installed on the system.
To start the configuration, we first have to create a new build directory.
We want to build the STREAM benchmark, so we create a new folder <cite>build/STREAM</cite> and change into this directory by calling:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span>build/STREAM
<span class="nb">cd</span><span class="w"> </span>build/STREAM
</pre></div>
</div>
<p>In the next step we can already configure the build.
Therefore, we call CMake with the configuration parameters we explicitly want to set.
A call could look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>../../STREAM<span class="w"> </span>-DNUM_REPLICATIONS<span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>-DFPGA_BOARD_NAME<span class="o">=</span>fictional_fpga<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>-DVECTOR_COUNT<span class="o">=</span><span class="m">16</span><span class="w"> </span>-DGLOBAL_MEM_UNROLL<span class="o">=</span><span class="m">1</span><span class="w"> </span>-DDATA_TYPE<span class="o">=</span>float<span class="w"> </span><span class="se">\</span>
<span class="w">                    </span>-DXILINX_COMPILE_SETTINGS_FILE<span class="o">=</span>../../STREAM/settings/settings.compile.ini
<span class="w">                    </span>-DXILINX_LINK_SETTINGS_FILE<span class="o">=</span>../../STREAM/settings/settings.link.generator.ini
</pre></div>
</div>
<p>The number of kernel replications should be set to match the number of memory banks of the FPGA.
In this example, the FPGA has four memory banks. We want to create a kernel replication for each of them.
The name of the target FPGA board has to be determined by <cite>xbutil scan</cite> or a similar command.</p>
<p>The third row of the command defines the data type that will be used for the benchmark.
Here we specify the data type to be <cite>float16</cite>, a vector data type provided by OpenCL.
This data type will contain 16 single-precision floating-point values, which again is equal to 64 bytes.
Since the memory interface of our FPGA has also a width of 64 bytes we set the unrolling to 1.
The unrolling will multiply the necessary width of the memory interface. Another possible option would have been to
use <cite>float</cite> by setting <code class="docutils literal notranslate"><span class="pre">VECTOR_COUNT</span></code> to 1 and unroll the loop 16 times by setting <code class="docutils literal notranslate"><span class="pre">GLOBAL_MEM_UNROLL</span></code> to 16.</p>
<p>The fourth row defines the location of the compile settings file that has to be used.
It usually contains the target kernel frequency and other information that might be needed by the Xilinx Vitis compiler during compilation time.</p>
<p>The last row defines the location to the link-time setting file.
It is used during the creation of the bitstream and contains information about the placement of the kernels in the FPGA and the mapping to the global memory.
The name of the settings file contains <cite>*.generator:*</cite> which is an indicator, that this settings file will be used as a template to generate a final settings file that matches
the configuration directly before synthesis.
This allows to create a single link settings file for an arbitrary number of kernel replications.</p>
<p>After executing the command above, the actual build files will be created.
Usually this will be Makefiles on Unix systems.
You can then start building the host code, create a report for the kernel code with the current configuration or even synthesize the kernel by using the matching build targets that are explained in the README.</p>
</section>
<section id="using-pre-defined-configurations">
<h2>Using pre-defined Configurations<a class="headerlink" href="#using-pre-defined-configurations" title="Link to this heading"></a></h2>
<p>Some benchmarks do also provide pre-defined configurations for a selection of FPGAs in the <cite>configs</cite> folder within their sources.
The configurations are <cite>*.cmake</cite> files that overwrite the default configuration options.
They can be used with CMake and the configuration option <cite>HPCC_FPGA_CONFIG</cite>.
As an example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>../../STREAM<span class="w"> </span>-DHPCC_FPGA_CONFIG<span class="o">=</span>../../STREAM/configs/Nallatech_520N_SP.cmake
</pre></div>
</div>
<p>Will use the pre-defined configuration for a Nallatech 520N board.
These configurations can also be used to document best practices in how to configure the benchmark for specific devices or architectures.
Note, that this option will overwrite all other options that may be given during CMake configuration!
To make changes on the configuration you need to unset the <cite>HPCC_FPGA_CONFIG</cite> variable by executing CMake as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>../../STREAM<span class="w"> </span>-UHPCC_FPGA_CONFIG
</pre></div>
</div>
<p>After that, you can make additional changes to the build configuration.</p>
</section>
</section>


           </div>
          </div>
    <a href="https://github.com/pc2/hpcc_fpga">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../b_eff/index.html" class="btn btn-neutral float-left" title="b_eff" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Host%20Input%20Parameters/index.html" class="btn btn-neutral float-right" title="Execution of a Benchmark" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Marius Meyer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
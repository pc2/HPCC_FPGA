

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PTRANS &mdash; HPCC FPGA Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=53b48696" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LINPACK" href="../LINPACK/index.html" />
    <link rel="prev" title="GEMM FPGA Benchmark Results" href="../GEMM/results/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            HPCC FPGA Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Benchmark Descriptions:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../STREAM/index.html">STREAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RandomAccess/index.html">RandomAccess</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FFT/index.html">FFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GEMM/index.html">GEMM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PTRANS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-parameters">Configuration Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detailed-description">Detailed Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../LINPACK/index.html">LINPACK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../b_eff/index.html">b_eff</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Support:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/Basic%20Setup/index.html">Basic Build Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/Host%20Input%20Parameters/index.html">Execution of a Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/Project%20Structure/index.html">Structure of the Benchmark Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/json_output/index.html">JSON Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_support/multi_fpga/index.html">Multi-FPGA Benchmarking</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Benchmark Results:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../FFT/results/index.html">FFT FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GEMM/results/index.html">GEMM FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RandomAccess/results/index.html">RandomAccess FPGA Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../STREAM/results/index.html">STREAM FPGA Benchmark Results</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HPCC FPGA Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">PTRANS</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <section id="ptrans">
<span id="id1"></span><h1>PTRANS<a class="headerlink" href="#ptrans" title="Link to this heading"></a></h1>
<p>This benchmark calculates a distributed blocked matrix transposition with <span class="math notranslate nohighlight">\(C = B + A^T\)</span> where <span class="math notranslate nohighlight">\(A,B,C \in \Bbb R^{n \times n}\)</span>.
So, a matrix <span class="math notranslate nohighlight">\(A\)</span> is transposed and added to another matrix <span class="math notranslate nohighlight">\(B\)</span>. The result is stored in a separate buffer.
All matrices are divided into blocks and the blocks are distributed over multiple FPGAs, so the FPGA will need to complete the calculation
using an inter-FPGA network.</p>
<p>The benchmark is designed to be easily extendable with different distribution schemes on the host side.</p>
<div class="toctree-wrapper compound">
</div>
<section id="configuration-parameters">
<h2>Configuration Parameters<a class="headerlink" href="#configuration-parameters" title="Link to this heading"></a></h2>
<p>In <a class="reference internal" href="#ptrans-config"><span class="std std-numref">Table 10</span></a> the configuration parameters are shown that are used to modify the kernel.
All other parameters can also later be changed with the host code during runtime.</p>
<span id="ptrans-config"></span><table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 10 </span><span class="caption-text">Configuration parameters for the Kernel</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 37.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NUM_REPLICATIONS</span></code></p></td>
<td><p>Replicates all kernels the given number of times. This allows to create a kernel pair for every available external channel in case of the circuit-switched network.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">BLOCK_SIZE</span></code></p></td>
<td><p>Size of the matrix blocks that are buffered in local memory and also distributed between the FPGAs.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CHANNEL_WIDTH</span></code></p></td>
<td><p>Width of the channels in data items. Together with the used data type, the width of the channel in bytes can be calculated.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DATA_TYPE</span></code></p></td>
<td><p>Specifies the used data type for the calculation.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="detailed-description">
<h2>Detailed Description<a class="headerlink" href="#detailed-description" title="Link to this heading"></a></h2>
<p>As mentioned at the beginning, the host code of this benchmark is designed to support different data distribution schemes between the FPGAs.</p>
<figure class="align-center" id="id4">
<span id="handler-class"></span><a class="reference internal image-reference" href="../_images/transpose_data_class.drawio.png"><img alt="../_images/transpose_data_class.drawio.png" src="../_images/transpose_data_class.drawio.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Class diagram showing the integration of the <code class="docutils literal notranslate"><span class="pre">TransposeDataHandler</span></code> interface into the implementation of the host code</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>An overview of the structure of the host code is given in <a class="reference internal" href="#handler-class"><span class="std std-numref">Fig. 6</span></a>.
Different host processes are communicating using MPI to allow scaling over multiple FPGAs, that may be installed on different nodes in a compute cluster.
Every MPI rank is in charge of a single FPGA and all objects shown in the figure are created on every MPI rank.
This means, the data handler and the generated data may differ between the MPI ranks depending on the chosen distribution scheme.
Therefore, the implementation introduces a new interface: <code class="docutils literal notranslate"><span class="pre">TransposeDataHandler</span></code>.
Implementations of this interface are managing the initialization of the <code class="docutils literal notranslate"><span class="pre">TransposeData</span></code> object for a given MPI rank,
which again holds the allocated memory for the kernel execution on the FPGA.
The default data distribution scheme is the block scattered distribution or also called PQ distribution.</p>
<p>The data exchange via MPI used in the baseline implementation is based on the algoorithm given in <a class="reference internal" href="#cho95" id="id2"><span>[CHO95]</span></a>.
The matrix transposition of the base implementation is implemented in a single kernel executing the following pipelines sequentially for every matrix block:</p>
<ul class="simple">
<li><p>Read a block of matrix A into local memory</p></li>
<li><p>Read block of matrix A transposed from local memory, read block of matix B from global memory, add both blocks and store result in second local memory buffer</p></li>
<li><p>Write the second memory buffer back to global memory.</p></li>
</ul>
<p>With this approach, every pipeline will either read or write to global memory. With that, the transpose kernels can be replicated per memory bank and utilization of the global memory bandwidth is maximized.</p>
<div role="list" class="citation-list">
<div class="citation" id="cho95" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">CHO95</a><span class="fn-bracket">]</span></span>
<p>Choi, Jaeyoung, Jack J. Dongarra, and David W. Walker. “Parallel matrix transpose algorithms on distributed memory concurrent computers.” Parallel Computing 21.9 (1995): 1387-1405.</p>
</div>
</div>
</section>
</section>


           </div>
          </div>
    <a href="https://github.com/pc2/hpcc_fpga">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
    </a>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../GEMM/results/index.html" class="btn btn-neutral float-left" title="GEMM FPGA Benchmark Results" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../LINPACK/index.html" class="btn btn-neutral float-right" title="LINPACK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Marius Meyer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>